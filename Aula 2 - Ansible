Passo 1: Crie o arquivo de inventário

O Ansible precisa de um arquivo de inventário para saber em quais máquinas ele deve atuar. Crie um arquivo chamado hosts.ini com o seguinte conteúdo:
Ini, TOML

[local]
localhost ansible_connection=local

Este arquivo define um grupo chamado [local] e especifica que a máquina a ser gerenciada é o localhost, usando uma conexão local.

Passo 2: Crie o Playbook Ansible

Um Playbook é um conjunto de instruções que o Ansible vai executar. Crie um arquivo chamado playbook.yml com o conteúdo abaixo:
YAML

---
- hosts: localhost
  tasks:
    - name: Criar um arquivo de teste
      file:
        path: /tmp/arquivo_de_teste.txt
        state: touch

Neste playbook:

    hosts: localhost: Indica que as tarefas serão executadas no localhost.

    tasks:: Inicia a lista de tarefas.

    name: Criar um arquivo de teste: É a descrição da tarefa (opcional, mas recomendado).

    file:: É o módulo do Ansible que gerencia arquivos.

    path: /tmp/arquivo_de_teste.txt: O caminho do arquivo que queremos criar.

    state: touch: A ação a ser tomada, que neste caso é criar o arquivo se ele não existir, semelhante ao comando touch.

Passo 3: Execute o Docker e o Ansible

Agora, vamos executar o contêiner Docker e instruí-lo a rodar nosso playbook. Você deve ter os arquivos hosts.ini e playbook.yml no mesmo diretório em que está executando o comando.
Bash

docker run --rm -v $(pwd):/ansible deltamir/terraform-ansible:1.8.0 ansible-playbook playbook.yml -i hosts.ini

Explicando o comando

    docker run --rm: Inicia e remove o contêiner após a execução.

    -v $(pwd):/ansible: Esta é a parte mais importante. Ela "monta" o seu diretório de trabalho atual ($(pwd)) dentro do contêiner, no diretório /ansible. Isso permite que o Ansible dentro do contêiner veja e acesse os arquivos hosts.ini e playbook.yml que você criou.

    deltamir/terraform-ansible:1.8.0: A imagem Docker que estamos usando.

    ansible-playbook playbook.yml -i hosts.ini: Este é o comando que será executado dentro do contêiner. Ele chama o ansible-playbook e especifica qual playbook (playbook.yml) e qual inventário (hosts.ini) ele deve usar.

Resultado

Após a execução do comando, o Ansible irá rodar o playbook e você verá uma saída similar a esta:
Bash

PLAY [localhost] ***************************************************************

TASK [Criar um arquivo de teste] ***********************************************
changed: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

Se o comando for executado com sucesso, o arquivo /tmp/arquivo_de_teste.txt será criado na sua máquina local. Você pode verificar isso com o comando ls /tmp/arquivo_de_teste.txt.

já estou dentro do docker, como faço?

Se você já está dentro do contêiner Docker (ou seja, você usou docker run -it e está no prompt de comando dele), o processo é um pouco diferente e mais direto.

Nesse caso, você precisa ter os arquivos do Ansible (hosts.ini e playbook.yml) disponíveis dentro do contêiner.

Opção 1: Se você montou o diretório (método recomendado)

Se você iniciou o contêiner com o comando docker run -it -v $(pwd):/ansible deltamir/terraform-ansible:1.8.0 /bin/bash, você já está no caminho certo. O seu diretório local está disponível no contêiner, no caminho /ansible.

    Acesse o diretório no contêiner:
    Bash

cd /ansible

Verifique se os arquivos estão lá:
Bash

ls

Você deve ver hosts.ini e playbook.yml listados.

Execute o playbook:
Bash

    ansible-playbook playbook.yml -i hosts.ini

========================================================== RODE AS DUAS OPÇÕES
Outra opção: montar o diretório /ansible após rodar docker

Se você apenas usou docker run -it deltamir/terraform-ansible:1.8.0 e está no prompt do contêiner, você terá que criar os arquivos diretamente dentro dele.

    Crie o arquivo de inventário hosts.ini:
    Bash

echo "[local]" > hosts.ini
echo "localhost ansible_connection=local" >> hosts.ini

Crie o playbook playbook.yml:
Bash

echo "---" > playbook.yml
echo "- hosts: localhost" >> playbook.yml
echo "  tasks:" >> playbook.yml
echo "    - name: Criar um arquivo de teste" >> playbook.yml
echo "      file:" >> playbook.yml
echo "        path: /tmp/arquivo_de_teste.txt" >> playbook.yml
echo "        state: touch" >> playbook.yml

Execute o playbook:
Bash

    ansible-playbook playbook.yml -i hosts.ini

Observação: O problema com esta opção é que o arquivo /tmp/arquivo_de_teste.txt será criado dentro do contêiner, não na sua máquina local. Quando você sair do contêiner, esse arquivo será perdido, já que o contêiner é efêmero. Por isso, a Opção 1 é sempre a mais indicada para trabalho prático, pois ela permite que o Ansible atue nos arquivos e na estrutura do seu sistema local.
